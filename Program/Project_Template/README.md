# Oscar 物联网开发板工程模板

netube_99 netube@163.com 2021.01.17

## 1.简介
Oscar开发板基于MDK开发环境的工程模板，此模板使用Keil5作为项目编译环境，VSCode作为代码编辑器，集成了GD32F1x0标准固件库V3.2版、Oscar开发板板级支持包BSP库、已配置完成的MDK工程，工程模板可直接编译；

![目录截图](./Document/IMG/目录截图.png)

## 2.使用教程
当您要创建一个新的工程时，可以直接复制 *Project Template* 文件夹，并重命名文件夹为您工程的名称；进入新工程文件夹并打开 *./Keil 目录下的Keil5工程 *Project.uvprojx* ，即可在原有的基础上直接进行后续开发；

我一般在工程文件夹内空白处右键，使用VSCode打开文件夹，并使用VSCode编写代码，编写完成后再转到Keil5编译项目、Debug和烧录代码；

本工程模板和普通的Keil5工程项目无区别，初学者请参考网络Keil5开发教程；本模板已完成了板载电路所需的BSP驱动库，在 目录*./BSP* 下，并且BSP库已通过 *./User/Source/main.h* 引用到项目代码中；

## 3.文件夹
### Device
此文件夹下的文件源自于兆易创新GD32官网提供的 *GD32F1x0_Firmware_Library_v3.1.0* 标准固件库，分别为内核 *CMSIS* 和外设 *GD32F1x0_standard_peripheral*，这些库文件是开发GD32F130单片机必不可少的，已引用到工程项目中；

这两个文件夹下的内容为只读模式，因为开发大多数情况都不需要对这些文件进行编辑，随意改动会导致难以排查的BUG出现，但我在编写BSP的过程中修改了一些地方，将在第4章详细说明；

### BSP
此文件夹下的文件为Oscar开发板的板级支持包文件，包含了MCU外设初始化设置函数与板载外围电路所需的基础操作函数；可以理解为Oscar开发板运行所需的硬件驱动，您可以在应用层开发的过程中引用BSP下的库文件，并使用库中提供的各种函数去控制电路;

因为Oscar是作为灵活的开发板为目标设计的，它可以被设计出各种功并应用在不同的场景，所以我在编写BSP库的时候并不能面面俱到写出万能的通用函数，只是提供了基础的代码模板，强调通用但针对性不强，仅用于入门学习与运行测试，您在使用的过程中应根据具体需求修改、添加甚至重写BSP库里的代码，让它们可以更好的运行于新设计中；

### User
*main.c* 等应用层的代码请添加至此文件夹中，与BSP里偏向底层驱动的代码不同，这里面存放的代码是对BSP的应用，是实现逻辑、功能、构成完整设计的代码；

### Keil
这里是Keil5工程文件的存放目录，您的新项目就是从这里的 *Project.uvprojx* 文件开始的，当您对工程进行编译后，编译产生的中间文件与输出目标文件会出现在 *./Objects* 文件夹中，您可以在这里找到调试需要的 *XXX.axf* 文件，或最终需要烧录到产品里的 *XXX.hex* 文件；

### Document
顾名思义这里存放的是和工程相关的文档，您可以在这里找到原版BSP库的Doxygen库函数注释页面（搜索index.html可以打开首页），通过浏览这份生成的本地网页，您可以轻松地上手使用原版BSP库的使用教程，比如函数功能、传入参数选项、函数使用注意事项等等，帮助您快速上手使用BSP库代码；

还有其他的一些文档数据，比如说您正在看的这份Readme。

## 4.注意事项
1. 在首次使用GD32F130这款芯片的时候，您应该给您电脑上的Keil5 安装 GD32F1x0支持包，支持包文件在本项目开源文件夹中: [支持包](../../Document/DATASHEET/GD32/GigaDevice.GD32F1x0_DFP.3.2.0.pack)，打开后可以直接安装，前提是您已经正确安装了Keil5；

2. 如果编译未经修改的工程模块后出现了大量的报错提示，您应该去下载这个支持包安装，大概率可以解决报错问题，但具体原因我也没有搞明白，毕竟我也是第一次用Keil5做单片机开发，下载地址：https://armkeil.blob.core.windows.net/legacy/MDKCM525.EXE

3. 在GD32F1x0的用户手册第75页可以看到这样一段文字：*AHB和APB2/APB1域的最高时钟频率为72MHz。但当使用I2C外设时，APB1时钟需保证不大于36MHz。*但是F130的固件库原版直接编译出来的时钟频率是主频72M，APB1也是72M；因为Oscar是有使用I2C外设的，按照手册的要求，我修改了 *Project_Template/Device/CMSIS/GD/GD32F1x0/Source* 目录下的文件 *system_gd32f1x0.c* 第201行，通过给时钟树二分频，将APB1的时钟设置为了36M，保证I2C外设的正常工作；